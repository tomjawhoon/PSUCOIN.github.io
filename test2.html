<!DOCTYPE html>
<html>

<head>
    <title>TEST WEBSOCKET</title>
    <link href="https://fonts.googleapis.com/css?family=Francois+One&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/push.js/1.0.5/push.js"></script>


</head>
<style type="text/css">
    #myDiv {
        border: 1px solid #000;
        padding: 9px;
        width: 50%;
        margin-bottom: 14px;
    }
</style>

<body>
    <div id="myDiv"></div>
</body>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
    crossorigin="anonymous"></script>
<script>

    var url;
    var id; //5935512088
    (() => {
        url = window.location.href
        id = url.split('/').slice(-1).toString() // ไอดี ของผู้ login
    })()
    // ทำการเชื่อม Websocket Server ตาม url ที่กำหนด


    axios({
        method: 'GET',
        url: '/getWalletById', //ส่งไปค่านี้
        headers: {
            id: id  // รหัสนักศึกษา
        }
    }).then(test => {
        console.log("test ===>", test);
        console.log("test.address ===>", test.data.address);
        var connection = new WebSocket('ws://localhost:4000')
        connection.onopen = () => {
            // จะทำงานเมื่อเชื่อมต่อสำเร็จ
            console.log("connect webSocket");
            connection.send(id); // ส่ง Data ไปที่ Server //5935512088
        };
        connection.onerror = (error) => {
            console.error('WebSocket Error ' + error);
        };
        connection.onmessage = (result) => {
            console.log("result Server ==>: ", result)
            console.log("result Server.data ==>: ", result.data)
            Swal.fire({
                position: 'top-end',
                icon: 'success',
                title: 'มีเงินโอนเข้ามา',
                showConfirmButton: false,
                timer: 2000
            })
            //createDivElement(e.data)
            Push.create("PSUCOIN WELCOME", {
                body: "มีเงินโอนเข้ามาเด้อ",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/Prince_of_Songkla_University_Emblem.png/150px-Prince_of_Songkla_University_Emblem.png",
                timeout: 5000,
                onClick: function () {
                    console.log(this);
                }
            });
        };
    })

    /* function createDivElement(data) {
                var newDiv = document.createElement('div')
                newDiv.setAttribute("id", "myDiv");
                newDiv.innerHTML = data
                document.body.appendChild(newDiv)
              }*/
</script>

</html>